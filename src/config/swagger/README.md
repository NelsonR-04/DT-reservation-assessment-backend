# Swagger Documentation Setup

This directory contains the Swagger/OpenAPI documentation configuration for the Coworking Reservation API.

## Structure

```
swagger/
├── swagger.config.ts      # Main Swagger configuration with swagger-jsdoc
├── swagger.setup.ts       # Express middleware setup for Swagger UI
├── schemas/               # Reusable schema definitions
│   ├── place.yaml        # Place model schemas
│   ├── space.yaml        # Space model schemas
│   ├── reservation.yaml  # Reservation model schemas
│   └── error.yaml        # Error response schemas
├── paths/                 # API endpoint documentation
│   ├── health.yaml       # Health check endpoint
│   ├── place.yaml        # Place endpoints (/lugares)
│   ├── space.yaml        # Space endpoints (/espacios)
│   └── reservation.yaml  # Reservation endpoints (/reservas)
└── generated/             # Auto-generated JSON schemas from Prisma
    └── json-schema.json  # Generated by prisma-json-schema-generator
```

## Features

- ✅ **No JSDoc comments needed** - All documentation in YAML files
- ✅ **Automatic schema generation** - Prisma models → JSON schemas
- ✅ **Reusable components** - DRY principle for schemas and responses
- ✅ **OpenAPI 3.0 compliant** - Industry standard
- ✅ **Interactive UI** - Swagger UI for testing endpoints

## Accessing the Documentation

Once the server is running, you can access:

- **Swagger UI**: http://localhost:3000/api-docs
- **OpenAPI JSON**: http://localhost:3000/api-docs.json

## Generating Schemas

The Prisma JSON schemas are automatically generated when you run:

```bash
npm run swagger:generate
# or
npm run prisma:generate
```

This will create the `generated/json-schema.json` file with the Prisma model schemas.

## Authentication

The API uses API key authentication. To test endpoints in Swagger UI:

1. Click the **Authorize** button in the top right
2. Enter your API key in the `x-api-key` field
3. Click **Authorize**

The API key should match the `API_KEY` environment variable in your `.env` file.

## Adding New Endpoints

To document a new endpoint:

1. **Create or update a path YAML file** in `paths/`:

```yaml
paths:
  /my-endpoint:
    get:
      tags:
        - MyResource
      summary: Description
      responses:
        '200':
          description: Success
```

2. **Create schemas if needed** in `schemas/`:

```yaml
components:
  schemas:
    MyModel:
      type: object
      properties:
        id:
          type: integer
```

3. The changes will be automatically picked up by swagger-jsdoc (restart server if needed)

## Business Rules Documentation

Important business rules are documented directly in the endpoint descriptions:

- **Reservations**: No scheduling conflicts, max 3 active reservations per client per week
- **Time validation**: End time must be after start time
- **Resource validation**: Space must exist and be available

## Error Responses

Common error responses are defined in `schemas/error.yaml` and reused across all endpoints:

- `400` - Bad Request
- `401` - Unauthorized (invalid API key)
- `404` - Not Found
- `409` - Conflict (scheduling conflict or duplicate)
- `422` - Validation Error
- `500` - Internal Server Error

## YAML vs JSDoc

This implementation uses YAML files instead of JSDoc comments because:

- ✅ Better separation of concerns
- ✅ Easier to maintain and update
- ✅ More readable for non-JavaScript developers
- ✅ Reusable components across multiple endpoints
- ✅ No code pollution with documentation comments

## References

- [Swagger/OpenAPI Specification](https://swagger.io/specification/)
- [swagger-jsdoc](https://github.com/Surnet/swagger-jsdoc)
- [swagger-ui-express](https://github.com/scottie1984/swagger-ui-express)
- [prisma-json-schema-generator](https://github.com/valentinpalkovic/prisma-json-schema-generator)
